<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Resizable Window with Inner Panels</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/xml/xml.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/javascript/javascript.min.js"></script>
    <style>
        #product-editor-outer-window {
            position: absolute;
            width: 400px;
            height: 500px;
            background-color: #f0f0f0;
            border: 1px solid #ccc;
            resize: both;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        #product-editor-header {
            background-color: #007bff;
            color: white;
            padding: 10px;
            cursor: move;
        }
        #product-editor-header, #product-editor-description-header, #product-editor-json-header {
            user-select: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
        }
        #product-editor-header span, #product-editor-description-header span, #product-editor-json-header span {
            cursor: default;
            pointer-events: none;
        }
        #product-editor-inner-container {
            display: flex;
            flex-direction: column;
            flex-grow: 1;
            overflow: hidden;
        }
        #product-editor-top-container, #product-editor-bottom-container {
            display: flex;
            flex-direction: column;
            flex-grow: 1;
            overflow: hidden;
        }
        #product-editor-top-wrapper, #product-editor-bottom-wrapper {
            display: flex;
            flex-direction: column;
            flex-grow: 1;
            min-height: 0;
        }
        #product-editor-description-header, #product-editor-json-header {
            background-color: #e9ecef;
            color: #495057;
            padding: 5px 10px;
            font-weight: bold;
            border-bottom: 1px solid #ced4da;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        #product-editor-resizer {
            height: 11px;
            background-color: white;
            cursor: row-resize;
            border-top: 1px solid black;
            border-bottom: 1px solid black;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-shrink: 0;
        }
        #product-editor-resizer::after {
            content: "";
            width: 30px;
            height: 4px;
            background-color: #ccc;
            border-radius: 2px;
        }
        #product-editor-top-editor, #product-editor-bottom-editor {
            flex-grow: 1;
            overflow: hidden;
        }
        #product-editor-top-editor .CodeMirror, #product-editor-bottom-editor .CodeMirror {
            height: 100% !important;
        }
        .CodeMirror-scroll {
            overflow-x: hidden !important;
            overflow-y: auto !important;
        }
        #product-editor-toggle-view {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 5px 10px;
            cursor: pointer;
            font-size: 12px;
        }
        #product-editor-rendered-html {
            flex-grow: 1;
            overflow-y: auto;
            overflow-x: hidden;
            padding: 10px;
            display: none;
        }
    </style>
</head>
<body>
    <div id="product-editor-outer-window">
        <div id="product-editor-header"><span>Product Editor</span></div>
        <div id="product-editor-inner-container">
            <div id="product-editor-top-container">
                <div id="product-editor-top-wrapper">
                    <div id="product-editor-description-header">
                        <span>Product Description</span>
                        <button id="product-editor-toggle-view">View Rendered</button>
                    </div>
                    <div id="product-editor-top-editor"></div>
                    <div id="product-editor-rendered-html"></div>
                </div>
            </div>
            <div id="product-editor-resizer"></div>
            <div id="product-editor-bottom-container">
                <div id="product-editor-bottom-wrapper">
                    <div id="product-editor-json-header">
                        <span>Product JSON</span>
                    </div>
                    <div id="product-editor-bottom-editor"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const outerWindow = document.getElementById('product-editor-outer-window');
        const header = document.getElementById('product-editor-header');
        const resizer = document.getElementById('product-editor-resizer');
        const topEditorContainer = document.getElementById('product-editor-top-editor');
        const bottomEditorContainer = document.getElementById('product-editor-bottom-editor');
        const toggleButton = document.getElementById('product-editor-toggle-view');
        const renderedHtml = document.getElementById('product-editor-rendered-html');

        // Initialize CodeMirror editors
        const topEditor = CodeMirror(topEditorContainer, {
            value: '<h1>Product Name</h1>\n<p>This is a <strong>great product</strong> that you will love!</p>\n<ul>\n  <li>Feature 1: Lorem ipsum dolor sit amet, consectetur adipiscing elit.</li>\n  <li>Feature 2: Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.</li>\n  <li>Feature 3: Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris.</li>\n</ul>',
            mode: 'xml',
            lineNumbers: true,
            lineWrapping: true,
            scrollbarStyle: 'native'
        });

        const bottomEditor = CodeMirror(bottomEditorContainer, {
            value: '{\n  "name": "Product Name",\n  "price": 99.99,\n  "description": "This is a great product that you will love!",\n  "features": [\n    "Feature 1: Lorem ipsum dolor sit amet, consectetur adipiscing elit.",\n    "Feature 2: Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.",\n    "Feature 3: Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris."\n  ]\n}',
            mode: 'javascript',
            lineNumbers: true,
            lineWrapping: true,
            scrollbarStyle: 'native'
        });

        // Toggle view function
        let isRendered = false;
        toggleButton.addEventListener('click', () => {
            isRendered = !isRendered;
            if (isRendered) {
                renderedHtml.innerHTML = topEditor.getValue();
                renderedHtml.style.display = 'block';
                topEditorContainer.style.display = 'none';
                toggleButton.textContent = 'View Code';
            } else {
                renderedHtml.style.display = 'none';
                topEditorContainer.style.display = 'block';
                toggleButton.textContent = 'View Rendered';
            }
        });

        // Make the outer window draggable
        let isDragging = false;
        let currentX;
        let currentY;
        let initialX;
        let initialY;
        let xOffset = 0;
        let yOffset = 0;

        header.addEventListener("mousedown", dragStart);
        document.addEventListener("mousemove", drag);
        document.addEventListener("mouseup", dragEnd);

        function dragStart(e) {
            if (e.target === header) {
                initialX = e.clientX - xOffset;
                initialY = e.clientY - yOffset;
                isDragging = true;
            }
        }

        function drag(e) {
            if (isDragging) {
                e.preventDefault();
                currentX = e.clientX - initialX;
                currentY = e.clientY - initialY;
                xOffset = currentX;
                yOffset = currentY;
                setTranslate(currentX, currentY, outerWindow);
            }
        }

        function dragEnd(e) {
            initialX = currentX;
            initialY = currentY;
            isDragging = false;
        }

        function setTranslate(xPos, yPos, el) {
            el.style.transform = `translate3d(${xPos}px, ${yPos}px, 0)`;
        }

        // Make the inner panels resizable
        let isResizing = false;
        let startY;
        let startTopHeight;

        resizer.addEventListener('mousedown', initResize);
        document.addEventListener('mousemove', resize);
        document.addEventListener('mouseup', stopResize);

        function initResize(e) {
            isResizing = true;
            startY = e.clientY;
            startTopHeight = resizer.previousElementSibling.offsetHeight;
        }

        function resize(e) {
            if (isResizing) {
                const difference = e.clientY - startY;
                const newTopHeight = startTopHeight + difference;
                const containerHeight = outerWindow.offsetHeight - header.offsetHeight - resizer.offsetHeight;
                
                if (newTopHeight > 0 && newTopHeight < containerHeight) {
                    resizer.previousElementSibling.style.height = `${newTopHeight}px`;
                    resizer.nextElementSibling.style.height = `${containerHeight - newTopHeight}px`;
                    topEditor.setSize(null, newTopHeight - 30); // Subtract header height
                    bottomEditor.setSize(null, containerHeight - newTopHeight - 30); // Subtract header height
                    topEditor.refresh();
                    bottomEditor.refresh();
                }
            }
        }

        function stopResize() {
            isResizing = false;
        }

        // Refresh CodeMirror editors when the window is resized
        new ResizeObserver(() => {
            topEditor.refresh();
            bottomEditor.refresh();
        }).observe(outerWindow);

        // Initial size set
        setTimeout(() => {
            const containerHeight = outerWindow.offsetHeight - header.offsetHeight - resizer.offsetHeight;
            const halfHeight = containerHeight / 2;
            resizer.previousElementSibling.style.height = `${halfHeight}px`;
            resizer.nextElementSibling.style.height = `${halfHeight}px`;
            topEditor.setSize(null, halfHeight - 30);
            bottomEditor.setSize(null, halfHeight - 30);
            topEditor.refresh();
            bottomEditor.refresh();
        }, 0);
    </script>
</body>
</html>
