THIS CODE WORKED
----------------------------------------------------------
ajax.js

sip.ajax = (function($) {
    var successHandlers = {};
    /**
     * Initialize the AJAX module
     * Sets up event listeners for global AJAX-related actions
     */
    function init() {
        // Handle New Store Token button click
        $('#new-token-button').on('click', function (e) {
            e.preventDefault();
            var formData = new FormData();
            formData.append('action', 'sip_handle_ajax_request');
            formData.append('action_type', 'new_token');
            formData.append('nonce', sipAjax.nonce);
            handleAjaxAction('new_token', formData, '#new-token-button', '#loading-spinner');
        });

        // Handle Save Token form submission
        $('#save-token-form').on('submit', function (e) {
            e.preventDefault();
            var formData = new FormData(this);
            formData.append('action', 'sip_handle_ajax_request');
            formData.append('action_type', 'save_token');
            formData.append('nonce', sipAjax.nonce);
            handleAjaxAction('save_token', formData, null, '#loading-spinner');
        });
    }


  /**
     * Handle successful AJAX responses
     * @param {string} actionType - Type of action that was performed
     * @param {Object} response - Response data from the server
     */
    function handleSuccessResponse(actionType, response) {
        console.log('Handling success response for action type:', actionType);
        console.log('Registered handlers:', successHandlers);
        console.log('Response:', response);

        switch (actionType) {
            case 'save_token':
            case 'new_token':
                location.reload();
                break;
        default:
            if (successHandlers[actionType]) {
                console.log('Calling success handler for', actionType);
                try {
                    successHandlers[actionType](response);
                } catch (error) {
                    console.error('Error in success handler for', actionType, ':', error);
                }
            } else {
                console.warn('No success handler found for action type:', actionType);
            }
            

            
            console.log('Exiting handleSuccessResponse in ajax.js');
        }
    }


----------------------------------------------------------
product-functions.php

// Fetch products directly from Printify API using the Bearer token
function fetch_products($encrypted_token, $shop_id) {
    // Decrypt the token before using it
    $token = sip_decrypt_token($encrypted_token);
    
    error_log('shop_id: ' . $shop_id);   
    
    $url = "https://api.printify.com/v1/shops/{$shop_id}/products.json";

    $response = wp_remote_get($url, array(
        'headers' => array(
            'Authorization' => 'Bearer ' . $token,
        ),
    ));

    if (is_wp_error($response)) {
        error_log('fetch_products encountered an error: ' . $response->get_error_message());
        return null;
    }

    $body = wp_remote_retrieve_body($response);
    $products = json_decode($body, true);

    // Ensure that $products is an array
    if (!is_array($products)) {
        error_log('fetch_products: $products is not an array');
        return null;
    }

    if (empty($products) || !isset($products['data'])) {
        error_log('fetch_products received empty or invalid data');
        return null;
    }

    error_log('fetch_products retrieved ' . count($products['data']) . ' products');

    // Save each product as a separate JSON file
    save_products_to_json($products['data']);

    return $products['data']; // Return only the 'data' field that contains the products
}



-----------------------------------------------------------
shop-functions.php

<?php

/**
 * Fetch shop details directly from Printify API using the Bearer token.
 *
 * @param string $token The Bearer token for authenticating API requests.
 * @return array|null Array with shop ID and shop name, or null if error occurs.
 */
function fetch_shop_details($token) {
    $url = 'https://api.printify.com/v1/shops.json';

    $response = wp_remote_get($url, array(
        'headers' => array(
            'Authorization' => 'Bearer ' . $token,
        ),
    ));

    if (is_wp_error($response)) {
        return null;
    }

    $body = wp_remote_retrieve_body($response);
    $data = json_decode($body, true);

    if (empty($data) || !isset($data[0]['id']) || !isset($data[0]['title'])) {
        return null;
    }

    return array(
        'shop_id'   => $data[0]['id'],
        'shop_name' => $data[0]['title']
    );
}

/**
 * Save shop details retrieved from Printify API into WordPress options.
 */
function sip_connect_shop() {
    $token = get_option('printify_bearer_token');
    $shop_details = fetch_shop_details($token);
    if ($shop_details) {
        update_option('sip_printify_shop_name', $shop_details['shop_name']);
        update_option('sip_printify_shop_id', $shop_details['shop_id']);
    }
}

/**
 * Save the Printify API token and store shop details.
 */
function sip_save_token() {
    $token = sanitize_text_field($_POST['printify_bearer_token']);
    $shop_details = fetch_shop_details($token);
    if ($shop_details) {
        $encrypted_token = sip_encrypt_token($token);
        update_option('printify_bearer_token', $encrypted_token);
        update_option('sip_printify_shop_name', $shop_details['shop_name']);
        update_option('sip_printify_shop_id', $shop_details['shop_id']);

        // Fetch and store images
        $remote_images = fetch_images($token);
        if ($remote_images !== null) {
            // Get existing images from options
            $existing_images = get_option('sip_printify_images', array());

            // Separate local images from existing images
            $local_images = array_filter($existing_images, function($image) {
                return isset($image['location']) && $image['location'] === 'Local File';
            });

            // Merge local images with newly fetched remote images
            $images = array_merge($local_images, $remote_images);

            // Update the images option with the merged array
            update_option('sip_printify_images', $images);
        }

        // Fetch and store products
        $encrypted_token = get_option('printify_bearer_token');
        $shop_id = get_option('sip_printify_shop_id');
        $products = fetch_products($encrypted_token, $shop_id);
        if ($products) {
            update_option('sip_printify_products', $products);
        }

        wp_send_json_success('Token saved and connection successful.');
    } else {
        wp_send_json_error('Invalid API token. Please check and try again.');
    }
}

/**
 * Reset the API token and associated shop details.
 * Only remote images are removed; local images remain in the database.
 */
function sip_new_token() {
    delete_option('printify_bearer_token');  // Clear the API token
    delete_option('sip_printify_shop_name'); // Clear the saved shop name
    delete_option('sip_printify_shop_id');   // Clear the saved shop ID
    delete_option('sip_printify_products');  // Clear the products

    // Retrieve existing images
    $images = get_option('sip_printify_images', array());

    // Check if images are not empty
    if (!empty($images)) {
        // Filter out remote images (keep only local images)
        $local_images = array_filter($images, function($image) {
            // Check if 'location' key exists and is set to 'Local File'
            return isset($image['location']) && $image['location'] === 'Local File';
        });

        // Update the images option with only local images
        update_option('sip_printify_images', $local_images);
    }

    // Delete product JSON files associated with the shop
    clear_product_jsons();

    wp_send_json_success('Token reset successfully.');
}

/**
 * Clear product JSON files associated with the shop.
 */
function clear_product_jsons() {
    $upload_dir = wp_upload_dir();
    $target_dir = $upload_dir['basedir'] . '/sip-printify-manager/products/';

    // Log the target directory being checked
    error_log("Checking target directory for product JSON files: $target_dir");

    // Check if the directory exists
    if (is_dir($target_dir)) {
        $files = glob($target_dir . '*.json'); // Get all JSON files in the directory

        // Log the number of files found
        error_log("Found " . count($files) . " product JSON files to delete.");

        foreach ($files as $file) {
            if (unlink($file)) { // Delete each file
                error_log("Successfully deleted product JSON file: $file");
            } else {
                error_log("Failed to delete product JSON file: $file");
            }
        }

        // Log completion of deletion process
        error_log("Completed deletion process for product JSON files in directory: $target_dir");
    } else {
        error_log("Target directory does not exist: $target_dir");
    }
}

/**
 * Generate and store the encryption key if it doesn't already exist.
 *
 * This key is used to encrypt and decrypt sensitive information such as the bearer token.
 * It is automatically generated and stored securely in the WordPress options table.
 *
 * @return string The encryption key.
 */
function sip_generate_encryption_key() {
    // Check if the encryption key already exists
    $encryption_key = get_option('sip_printify_encryption_key');

    if (empty($encryption_key)) {
        // Generate a secure encryption key (32 bytes for AES-256)
        $encryption_key = base64_encode(random_bytes(32));
        update_option('sip_printify_encryption_key', $encryption_key);
    }

    return $encryption_key;
}

/**
 * Encrypt the bearer token before storing it.
 *
 * @param string $token The plain text bearer token.
 * @return string The encrypted token.
 */
function sip_encrypt_token($token) {
    // Get the encryption key from the options or generate one if it doesn't exist
    $encryption_key = sip_generate_encryption_key();

    // Initialization Vector (IV) for AES encryption (16 bytes)
    $iv = substr(hash('sha256', '16_char_iv_here'), 0, 16);
    return openssl_encrypt($token, 'AES-256-CBC', base64_decode($encryption_key), 0, $iv);
}

/**
 * Decrypt the bearer token when retrieving it.
 *
 * @param string $encrypted_token The encrypted token.
 * @return string The plain text bearer token.
 */
function sip_decrypt_token($encrypted_token) {
    // Retrieve the encryption key
    $encryption_key = get_option('sip_printify_encryption_key');

    // Initialization Vector (IV) for AES decryption
    $iv = substr(hash('sha256', '16_char_iv_here'), 0, 16);
    return openssl_decrypt($encrypted_token, 'AES-256-CBC', base64_decode($encryption_key), 0, $iv);
}